{
  "__type__": "Config",
  "context": {
    "__type__": "Context",
    "customer": "changningquzhengfu",
    "project": "changningproject",
    "env": "development",
    "description": "这是为长宁区政府项目metis-mt的本地测试环境部署的配置文件",
    "mode": "docker",
    "os": "centos",
    "osVersion": "7.7",
    "dataPathRoot": "../project-changning-second/data_root",
    "imageOutputRootDir": "../project-changning-second/images"
  },
  "services": [
    {
      "__type__": "Service",
      "name": "postgres",
      "namespace": "identity",
      "imageCategory": "thirdparty",
      "srcImage": "postgres:11.5-alpine",
      "docker": {
        "__type__": "ServiceDockerConfig",
        "containerName": "pg",
        "restart": "always",
        "useHostNetwork": false,
        "ports": [
          "5432:5432"
        ],
        "envs": [
          "POSTGRES_PASSWORD=\"Kt4C4TCHJ3\""
        ],
        "volumes": [
          "/postgres:/var/lib/postgresql/data"
        ],
        "command": ""
      }
    },
    {
      "__type__": "Service",
      "name": "redis",
      "namespace": "expert",
      "imageCategory": "thirdparty",
      "srcImage": "redis:5.0.5-alpine",
      "docker": {
        "__type__": "ServiceDockerConfig",
        "containerName": "expert_redis",
        "restart": "always",
        "useHostNetwork": false,
        "ports": [
          "6379:6379"
        ],
        "envs": [
          "REDIS_PASSWORD=\"bzpXOAb5GkBO\""
        ],
        "volumes": [],
        "command": "redis-server --requirepass \"bzpXOAb5GkBO\" --appendonly \"yes\""
      }
    },
    {
      "__type__": "Service",
      "name": "token_mt",
      "namespace": "identity",
      "imageCategory": "identity",
      "srcImage": "identity/token_mt:latest",
      "docker": {
        "__type__": "ServiceDockerConfig",
        "containerName": "token_mt",
        "restart": "always",
        "useHostNetwork": false,
        "ports": [
          "5100:5100"
        ],
        "envs": [
          "SECRET_KEY=\"jd98u3oijmrf9u02p3kemf9q7uyrhfgnm4tuer9vcjkm34ijo\"",
          "SECRET_EXPIRED_DAYS=\"7\"",
          "SECRET_STATIC=\"true\""
        ],
        "volumes": [],
        "command": ""
      }
    },
    {
      "__type__": "Service",
      "name": "identity_api",
      "namespace": "identity",
      "imageCategory": "identity",
      "srcImage": "identity/identity_api:latest",
      "docker": {
        "__type__": "ServiceDockerConfig",
        "containerName": "identity_api",
        "restart": "always",
        "useHostNetwork": false,
        "ports": [
          "5200:5200"
        ],
        "envs": [
          "POSTGRES=\"postgres:Kt4C4TCHJ3@192.168.1.149:5432\"",
          "POSTGRES_IDENTITY=\"identity-management\"",
          "SERVICE_SECRET=\"http://192.168.1.149:5100/secret\""
        ],
        "volumes": [],
        "command": ""
      }
    },
    {
      "__type__": "Service",
      "name": "homapage_ui",
      "namespace": "identity",
      "imageCategory": "identity",
      "srcImage": "identity/homepage_ui:latest",
      "docker": {
        "__type__": "ServiceDockerConfig",
        "containerName": "homepage_ui",
        "restart": "always",
        "useHostNetwork": false,
        "ports": [
          "8081:8082"
        ],
        "envs": [
          "VUE_APP_TENANT=\"minerva\"",
          "VUE_APP_TENANT_NAME=\"美能华\"",
          "VUE_APP_HOMEPAGE_ROOT_URL=\"//192.168.1.149:8081\"",
          "VUE_APP_ACCOUNT_ROOT_URL=\"//192.168.1.149:8083\"",
          "VUE_APP_IDENTITY_HOST=\"//192.168.1.149:5200/v1\"",
          "VUE_APP_COOKIE_DOMAIN_NAME=\"\""
        ],
        "volumes": [],
        "command": ""
      }
    },
    {
      "__type__": "Service",
      "name": "identity_ui",
      "namespace": "identity",
      "imageCategory": "identity",
      "srcImage": "identity/identity_ui:latest",
      "docker": {
        "__type__": "ServiceDockerConfig",
        "containerName": "identity_ui",
        "restart": "always",
        "useHostNetwork": false,
        "ports": [
          "9100:9100"
        ],
        "envs": [
          "VUE_APP_HOMEPAGE_ROOT_URL=\"//192.168.1.149:8081\"",
          "VUE_APP_IDENTITY_HOST=\"//192.168.1.149:5200/v1\"",
          "VUE_APP_COOKIE_DOMAIN_NAME=\"\""
        ],
        "volumes": [],
        "command": ""
      }
    },
    {
      "__type__": "Service",
      "name": "metis_ui",
      "namespace": "expert",
      "imageCategory": "expert",
      "srcImage": "expert/metis_ui:v2",
      "docker": {
        "__type__": "ServiceDockerConfig",
        "containerName": "metis_ui",
        "restart": "always",
        "useHostNetwork": false,
        "privileged": true,
        "ports": [
          "8200:8200"
        ],
        "envs": [
          "NODE_ENV=\"production\"",
          "VUE_APP_TENANT=\"minerva\"",
          "VUE_APP_NAME=\"Metis\"",
          "VUE_APP_HOMEPAGE_ROOT_URL=\"//192.168.1.149:8081\"",
          "VUE_APP_METIS_HOST=\"//192.168.1.149:7046/v1\"",
          "VUE_APP_IDENTITY_HOST=\"//192.168.1.149:5200/v1\""
        ],
        "volumes": [],
        "command": ""
      }
    },
    {
      "__type__": "Service",
      "name": "metis_api",
      "namespace": "expert",
      "imageCategory": "expert",
      "srcImage": "expert/metis_api:v2",
      "docker": {
        "__type__": "ServiceDockerConfig",
        "containerName": "metis_api",
        "restart": "always",
        "useHostNetwork": false,
        "privileged": true,
        "ports": [
          "7046:7046"
        ],
        "envs": [
          "SERVICE_METIS=\"http://192.168.1.149:7047/v1\"",
          "SERVICE_SECRET=\"http://192.168.1.149:5100/secret\""
        ],
        "volumes": [],
        "command": ""
      }
    },
    {
      "__type__": "Service",
      "name": "metis_mt",
      "namespace": "expert",
      "imageCategory": "expert",
      "srcImage": "expert/metis_mt:v2",
      "docker": {
        "__type__": "ServiceDockerConfig",
        "containerName": "metis_mt",
        "restart": "always",
        "useHostNetwork": false,
        "privileged": true,
        "ports": [
          "7047:7045"
        ],
        "envs": [
          "POSTGRES_DATABASE=\"metis\"",
          "POSTGRES=\"postgres:Kt4C4TCHJ3@192.168.1.149:5432\"",
          "DEPOT=/app/data",
          "DEPOT_MODULE=/app/modules",
          "DEPOT_MODULE_v1=/app/modules_v1",
          "REDIS=\"user:bzpXOAb5GkBO@192.168.1.149:6379/1\"",
          "REDIS_DB=1"
        ],
        "volumes": [
          "/intelligence/expert/data:/app/data",
          "/intelligence/expert/modules_v2:/app/modules",
          "/intelligence/expert/modules_v1:/app/modules_v1"
        ],
        "command": ""
      }
    },
    {
      "__type__": "Service",
      "name": "metis_worker_manager",
      "namespace": "expert",
      "imageCategory": "expert",
      "srcImage": "metis/metis_worker_manager:v2",
      "docker": {
        "__type__": "ServiceDockerConfig",
        "containerName": "metis_worker_manager",
        "restart": "always",
        "useHostNetwork": false,
        "privileged": true,
        "ports": [
          "7308:7308"
        ],
        "envs": [
          "REDIS_ADDRESS=\"redis://:bzpXOAb5GkBO@192.168.1.149:6379/1\"",
          "WEBSOCKET_PORT=\"7308\"",
          "MODULE_PACKAGES_DIRECTORY=\"/app/wheel\""
        ],
        "volumes": [
          "/intelligence/expert/wheels:/app/wheel",
          "/intelligence/expert/log-v2:/app/log"
        ],
        "command": "",
        "dockerRunOptions": []
      }
    },
    {
      "__type__": "Service",
      "name": "metis_worker_cpu_1",
      "namespace": "expert",
      "imageCategory": "expert",
      "srcImage": "metis/metis_worker:v2",
      "docker": {
        "__type__": "ServiceDockerConfig",
        "containerName": "metis_worker_cpu_1",
        "restart": "always",
        "useHostNetwork": false,
        "privileged": true,
        "ports": [],
        "envs": [
          "MANAGER_WEBSOCKET_SERVER=192.168.1.149",
          "MANAGER_WEBSOCKET_PORT=\"7308\"",
          "MODULE_VIRTUAL_ENV_ROOT=\"/app/metis-module-venv\"",
          "MODULE_PACKAGES_DIRECTORY=\"/app/wheel\"",
          "MODULE_SOURCES_DIRECTORY=\"/app/modules\"",
          "RESOURCE_ROOT=\"/app/resource\"",
          "METIS_DATA_ROOT=\"/app/data\"",
          "WORKER_ID=\"worker_1\"",
          "WORKER_TYPE=cpu"
        ],
        "volumes": [
          "/intelligence/expert/wheels:/app/wheel",
          "/intelligence/expert/modules_v2:/app/modules",
          "/intelligence/expert/resource:/app/resource",
          "/intelligence/expert/log-v2:/app/log",
          "/intelligence/expert/data:/app/data"
        ],
        "command": "",
        "dockerRunOptions": []
      }
    },
    {
      "__type__": "Service",
      "name": "metis_worker_cpu_2",
      "namespace": "expert",
      "imageCategory": "expert",
      "srcImage": "metis/metis_worker:v2",
      "docker": {
        "__type__": "ServiceDockerConfig",
        "containerName": "metis_worker_cpu_2",
        "restart": "always",
        "useHostNetwork": false,
        "privileged": true,
        "ports": [],
        "envs": [
          "MANAGER_WEBSOCKET_SERVER=192.168.1.149",
          "MANAGER_WEBSOCKET_PORT=\"7308\"",
          "MODULE_VIRTUAL_ENV_ROOT=\"/app/metis-module-venv\"",
          "MODULE_PACKAGES_DIRECTORY=\"/app/wheel\"",
          "MODULE_SOURCES_DIRECTORY=\"/app/modules\"",
          "RESOURCE_ROOT=\"/app/resource\"",
          "METIS_DATA_ROOT=\"/app/data\"",
          "WORKER_ID=\"worker_2\"",
          "WORKER_TYPE=cpu"
        ],
        "volumes": [
          "/intelligence/expert/wheels:/app/wheel",
          "/intelligence/expert/modules_v2:/app/modules",
          "/intelligence/expert/resource:/app/resource",
          "/intelligence/expert/log-v2:/app/log",
          "/intelligence/expert/data:/app/data"
        ],
        "command": "",
        "dockerRunOptions": []
      }
    },
    {
      "__type__": "Service",
      "name": "metis_worker_gpu",
      "namespace": "expert",
      "imageCategory": "expert",
      "srcImage": "expert/metis_worker:beta",
      "docker": {
        "__type__": "ServiceDockerConfig",
        "containerName": "metis_worker_gpu",
        "restart": "always",
        "useHostNetwork": false,
        "privileged": true,
        "ports": [],
        "envs": [
          "DATA_ROOT=\"/app/data\"",
          "RESOURCE_ROOT=\"/app/resource\"",
          "CONFIGS_ROOT=\"/app/configs\"",
          "LOG_ROOT=\"/app/log\"",
          "MODULE_REPOSITORY=\"/app/modules\"",
          "REDIS_URL=\"redis://:bzpXOAb5GkBO@192.168.1.149:6379/1\"",
          "MT_GPU=\"0\"",
          "WORKER_ID=\"worker:gpu\""
        ],
        "volumes": [
          "/intelligence/expert/data:/app/data",
          "/intelligence/expert/wheels:/app/wheel",
          "/intelligence/expert/resource:/app/resource",
          "/intelligence/expert/modules_v1:/app/modules",
          "/intelligence/expert/configs:/app/configs",
          "/intelligence/expert/log:/app/log"
        ],
        "command": "",
        "dockerRunOptions": []
      }
    },
    {
      "__type__": "Service",
      "name": "metis_worker_gpu_v2",
      "namespace": "expert",
      "imageCategory": "expert",
      "srcImage": "metis/metis_worker_gpu:v1.5",
      "docker": {
        "__type__": "ServiceDockerConfig",
        "containerName": "metis_worker_gpu_v2",
        "restart": "always",
        "useHostNetwork": false,
        "privileged": true,
        "ports": [],
        "envs": [
          "MANAGER_WEBSOCKET_SERVER=192.168.1.149",
          "MANAGER_WEBSOCKET_PORT=\"7308\"",
          "WEBSOCKET_PORT=\"31000\"",
          "MODULE_PACKAGES_DIRECTORY=\"/app/wheel\"",
          "METIS_DATA_ROOT=\"/app/data\"",
          "WORKER_ID=\"gpu_worker_1\"",
          "WORKER_TYPE=\"gpu\"",
          "V1_REDIS_ADDRESS=\"redis://:bzpXOAb5GkBO@192.168.1.149:6379/1\""
        ],
        "volumes": [
          "/intelligence/expert/data:/app/data",
          "/intelligence/expert/wheels:/app/wheel",
          "/intelligence/expert/log-v2:/app/log"
        ],
        "command": "",
        "dockerRunOptions": []
      }
    },
    {
      "__type__": "Service",
      "name": "metis_worker_ctc",
      "namespace": "expert",
      "imageCategory": "expert",
      "srcImage": "metis/metis_worker_ctc:v2",
      "docker": {
        "__type__": "ServiceDockerConfig",
        "containerName": "metis_worker_ctc",
        "restart": "always",
        "useHostNetwork": false,
        "privileged": true,
        "ports": [],
        "envs": [
          "MANAGER_WEBSOCKET_SERVER=192.168.1.149",
          "MANAGER_WEBSOCKET_PORT=\"7308\"",
          "MODULE_VIRTUAL_ENV_ROOT=\"/app/metis-module-venv\"",
          "MODULE_PACKAGES_DIRECTORY=\"/app/wheel\"",
          "MODULE_SOURCES_DIRECTORY=\"/app/modules\"",
          "RESOURCE_ROOT=\"/app/resource\"",
          "METIS_DATA_ROOT=\"/app/data\"",
          "WORKER_ID=\"worker_ctc_1\"",
          "WORKER_TYPE=ctc"
        ],
        "volumes": [
          "/intelligence/expert/wheels:/app/wheel",
          "/intelligence/expert/modules_v2:/app/modules",
          "/intelligence/expert/resource:/app/resource",
          "/intelligence/expert/log-v2:/app/log",
          "/intelligence/expert/data:/app/data"
        ],
        "command": "",
        "dockerRunOptions": []
      }
    },
    {
      "__type__": "Service",
      "name": "expert_ui",
      "namespace": "expert",
      "imageCategory": "expert",
      "srcImage": "expert/expert_ui:latest",
      "docker": {
        "__type__": "ServiceDockerConfig",
        "containerName": "expert_ui",
        "restart": "always",
        "useHostNetwork": false,
        "ports": [
          "8085:8082"
        ],
        "envs": [
          "VUE_APP_TENANT=\"minerva\"",
          "VUE_APP_NAME=\"能手\"",
          "VUE_APP_FOOTER_TEXT=\"©2021 苏州美能华智能科技有限公司\"",
          "VUE_APP_COOKIE_DOMAIN_NAME=\"\"",
          "VUE_APP_HOMEPAGE_ROOT_URL=\"//192.168.1.149:8081\"",
          "VUE_APP_METIS=\"//192.168.1.149:8200\"",
          "VUE_APP_IDENTITY_HOST=\"//192.168.1.149:5200/v1\"",
          "VUE_APP_EXPERT_HOST=\"//192.168.1.149:7001/v1\""
        ],
        "volumes": [],
        "command": ""
      }
    },
    {
      "__type__": "Service",
      "name": "expert_api",
      "namespace": "expert",
      "imageCategory": "expert",
      "srcImage": "expert/expert_api:latest",
      "docker": {
        "__type__": "ServiceDockerConfig",
        "containerName": "expert_api",
        "restart": "always",
        "useHostNetwork": false,
        "ports": [
          "7001:7001"
        ],
        "envs": [
          "POSTGRES=\"postgres:Kt4C4TCHJ3@192.168.1.149:5432\"",
          "POSTGRES_DATABASE=\"expert\"",
          "SERVICE_SECRET=\"http://192.168.1.149:5100/secret\"",
          "SERVICE_METIS=\"http://192.168.1.149:7047/v1\""
        ],
        "volumes": [],
        "command": ""
      }
    },
    {
      "__type__": "Service",
      "name": "ui-second-entry",
      "namespace": "expert",
      "imageCategory": "approval",
      "srcImage": "approval/ui_second_entry:latest",
      "docker": {
        "__type__": "ServiceDockerConfig",
        "containerName": "ui_second_entry",
        "restart": "always",
        "useHostNetwork": false,
        "privileged": true,
        "ports": [
          "8102:8102"
        ],
        "envs": [
          "VUE_APP_BASE_API=http://192.168.1.149:7045",
          "NODE_ENV=production",
          "VUE_APP_TENANT_NAME=美能华智能科技",
          "VUE_APP_DEPARTMENT=shcn"
        ],
        "volumes": [],
        "command": ""
      }
    },
    {
      "__type__": "Service",
      "name": "api-second-entry",
      "namespace": "expert",
      "imageCategory": "approval",
      "srcImage": "approval/api_second_entry:latest",
      "docker": {
        "__type__": "ServiceDockerConfig",
        "containerName": "api_second_entry",
        "restart": "always",
        "useHostNetwork": false,
        "privileged": true,
        "ports": [
          "7045:7045"
        ],
        "envs": [
          "SERVICE_METIS=192.168.1.149:7047/v1",
          "ALL_RESULT_DIR=/app/json/",
          "SERVICE_SHCN=192.168.1.149:7050/v1",
          "PG_HOST=192.168.1.149",
          "PG_PORT=5432",
          "PG_DB=second-entry",
          "PG_USER=postgres",
          "PG_PASSWORD=Kt4C4TCHJ3"
        ],
        "volumes": [
          "/intelligence/expert/json:/app/json"
        ],
        "command": ""
      }
    },
    {
      "__type__": "Service",
      "name": "mt-shcn",
      "namespace": "expert",
      "imageCategory": "approval",
      "srcImage": "approval/mt_shcn:latest",
      "docker": {
        "__type__": "ServiceDockerConfig",
        "containerName": "mt_shcn",
        "restart": "always",
        "useHostNetwork": false,
        "privileged": true,
        "ports": [
          "7050:7050"
        ],
        "envs": [
          "MYSQL_HOST=192.168.1.149",
          "MYSQL_PORT=3306",
          "MYSQL_DB=mnhbj",
          "MYSQL_USER=mnh",
          "MYSQL_PASSWORD=mnh@123456"
        ],
        "volumes": [],
        "command": ""
      }
    }
  ],
  "dbInitializers": [
    {
      "__type__": "DatabaseInitializer",
      "name": "identity-db-initializer",
      "imageCategory": "identity",
      "srcImage": "identity/identity_db:latest",
      "useHostNetwork": false,
      "envs": [
        "POSTGRES_DB_IDENTITY_MANAGEMENT_HOST=192.168.1.149",
        "POSTGRES_DB_IDENTITY_MANAGEMENT_PORT=5432",
        "POSTGRES_DB_IDENTITY_MANAGEMENT_DATABASE=identity-management",
        "POSTGRES_DB_IDENTITY_MANAGEMENT_USERNAME=postgres",
        "POSTGRES_DB_IDENTITY_MANAGEMENT_PASSWORD=\"Kt4C4TCHJ3\"",
        "DB_EXECUTION_CONTEXT=demo"
      ]
    },
    {
      "__type__": "DatabaseInitializer",
      "name": "metis-db-initializer",
      "imageCategory": "expert",
      "srcImage": "expert/metis_db:latest",
      "envs": [
        "POSTGRES=postgres:Kt4C4TCHJ3@192.168.1.149:5432"
      ]
    },
    {
      "__type__": "DatabaseInitializer",
      "name": "expert-db-initializer",
      "imageCategory": "expert",
      "srcImage": "expert/expert_db:latest",
      "useHostNetwork": false,
      "envs": [
        "POSTGRES=postgres:Kt4C4TCHJ3@192.168.1.149:5432"
      ]
    },
    {
      "__type__": "DatabaseInitializer",
      "name": "second-entry-db-initializer",
      "imageCategory": "secondEntry",
      "srcImage": "approval/db_second_entry:latest",
      "envs": [
        "NODE_ENV=production",
        "POSTGRES=postgres:Kt4C4TCHJ3@192.168.1.149:5432"
      ]
    }
  ],
  "dockerContext": {
    "__type__": "DockerContext",
    "srcRegistryBase": "swr.cn-north-4.myhuaweicloud.com/meinenghua/"
  },
  "dbBackupAndRestoreContext": {
    "__type__": "DBBackupAndRestoreContext",
    "imageCategory": "thirdparty",
    "srcImage": "postgres:11.5-alpine",
    "databases": [
      {
        "__type__": "DatabaseInfo",
        "name": "identity-management",
        "server": "192.168.1.149",
        "port": "5432",
        "user": "postgres",
        "password": "Kt4C4TCHJ3",
        "diskDir": "/dbbackup/identity",
        "useHostNetwork": false
      },
      {
        "__type__": "DatabaseInfo",
        "name": "metis",
        "server": "192.168.1.149",
        "port": "5432",
        "user": "postgres",
        "password": "Kt4C4TCHJ3",
        "diskDir": "/dbbackup/metis",
        "useHostNetwork": true
      },
      {
        "__type__": "DatabaseInfo",
        "name": "expert",
        "server": "192.168.1.149",
        "port": "5432",
        "user": "postgres",
        "password": "Kt4C4TCHJ3",
        "diskDir": "/dbbackup/expert",
        "useHostNetwork": true
      },
      {
        "__type__": "DatabaseInfo",
        "name": "second-entry",
        "server": "192.168.1.149",
        "port": "5432",
        "user": "postgres",
        "password": "Kt4C4TCHJ3",
        "diskDir": "/dbbackup/second-entry",
        "useHostNetwork": false
      }
    ]
  }
}